!function(e,t){var i=function(){var e={};return function(e){!function(e,t,i){var n=window.setTimeout,r={},s=t.core.utils,a=t.runtime.Runtime;function o(e){var t=e.required_features,i={};function n(e,t,n){var r={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};r[e]?i[r[e]]=t:n||(i[e]=t)}return"string"==typeof t?l.each(t.split(/\s*,\s*/),function(e){n(e,!0)}):"object"==typeof t?l.each(t,function(e,t){n(t,e)}):!0===t&&(e.chunk_size&&e.chunk_size>0&&(i.slice_blob=!0),l.isEmptyObj(e.resize)&&!1!==e.multipart||(i.send_binary_string=!0),e.http_method&&(i.use_http_method=e.http_method),l.each(e,function(e,t){n(t,!!e,!0)})),i}var l={VERSION:"2.3.6.x",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,moxie:t,mimeTypes:s.Mime.mimes,ua:s.Env,typeOf:s.Basic.typeOf,extend:s.Basic.extend,guid:s.Basic.guid,getAll:function(e){var t,i=[];"array"!==l.typeOf(e)&&(e=[e]);for(var n=e.length;n--;)(t=l.get(e[n]))&&i.push(t);return i.length?i:null},get:s.Dom.get,each:s.Basic.each,getPos:s.Dom.getPos,getSize:s.Dom.getSize,xmlEncode:function(e){var t={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"};return e?(""+e).replace(/[<>&\"\']/g,function(e){return t[e]?"&"+t[e]+";":e}):e},toArray:s.Basic.toArray,inArray:s.Basic.inArray,inSeries:s.Basic.inSeries,addI18n:t.core.I18n.addI18n,translate:t.core.I18n.translate,sprintf:s.Basic.sprintf,isEmptyObj:s.Basic.isEmptyObj,hasClass:s.Dom.hasClass,addClass:s.Dom.addClass,removeClass:s.Dom.removeClass,getStyle:s.Dom.getStyle,addEvent:s.Events.addEvent,removeEvent:s.Events.removeEvent,removeAllEvents:s.Events.removeAllEvents,cleanName:function(e){var t,i;for(i=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],t=0;t<i.length;t+=2)e=e.replace(i[t],i[t+1]);return e=(e=e.replace(/\s+/g,"_")).replace(/[^a-z0-9_\-\.]+/gi,"")},buildUrl:function(e,t){var i="";return l.each(t,function(e,t){i+=(i?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(e)}),i&&(e+=(e.indexOf("?")>0?"&":"?")+i),e},formatSize:function(e){if(e===i||/\D/.test(e))return l.translate("N/A");function t(e,t){return Math.round(e*Math.pow(10,t))/Math.pow(10,t)}var n=Math.pow(1024,4);return e>n?t(e/n,1)+" "+l.translate("tb"):e>(n/=1024)?t(e/n,1)+" "+l.translate("gb"):e>(n/=1024)?t(e/n,1)+" "+l.translate("mb"):e>1024?Math.round(e/1024)+" "+l.translate("kb"):e+" "+l.translate("b")},parseSize:s.Basic.parseSizeStr,predictRuntime:function(e,t){var i,n;return i=new l.Uploader(e),n=a.thatCan(i.getOption().required_features,t||e.runtimes),i.destroy(),n},addFileFilter:function(e,t){r[e]=t}};l.addFileFilter("mime_types",function(e,t,i){e.length&&!e.regexp.test(t.name)?(this.trigger("Error",{code:l.FILE_EXTENSION_ERROR,message:l.translate("File extension error."),file:t}),i(!1)):i(!0)}),l.addFileFilter("max_file_size",function(e,t,i){e=l.parseSize(e),void 0!==t.size&&e&&t.size>e?(this.trigger("Error",{code:l.FILE_SIZE_ERROR,message:l.translate("File size error."),file:t}),i(!1)):i(!0)}),l.addFileFilter("prevent_duplicates",function(e,t,i){if(e)for(var n=this.files.length;n--;)if(t.name===this.files[n].name&&t.size===this.files[n].size)return this.trigger("Error",{code:l.FILE_DUPLICATE_ERROR,message:l.translate("Duplicate file error."),file:t}),void i(!1);i(!0)}),l.addFileFilter("prevent_empty",function(e,t,n){e&&!t.size&&t.size!==i?(this.trigger("Error",{code:l.FILE_SIZE_ERROR,message:l.translate("File size error."),file:t}),n(!1)):n(!0)}),l.Uploader=function(e){var s,u,c,d,f=l.guid(),p=[],g={},h=[],m=[],_=!1;function E(){var e,t,i=0;if(this.state==l.STARTED){for(t=0;t<p.length;t++)e||p[t].status!=l.QUEUED?i++:(e=p[t],this.trigger("BeforeUpload",e)&&(e.status=l.UPLOADING,this.trigger("UploadFile",e)));i==p.length&&(this.state!==l.STOPPED&&(this.state=l.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",p))}}function v(e){e.percent=e.size>0?Math.ceil(e.loaded/e.size*100):100,b()}function y(e,t){return new Promise(function(i,n){var r=t||10485760,s=Math.ceil(e.size/r);const a=new SparkMD5.ArrayBuffer,o=new FileReader;var l=0;function u(){var t=l*r,i=Math.min(t+r,e.size);o.readAsArrayBuffer(e.slice(t,i).getSource())}o.onload=function(e){a.append(e.target.result),++l<s?u():i(a.end())},o.onerror=function(e){e.target.abort(),n(e.target.error)},u()})}function b(){var e,t,n,r=0;for(c.reset(),e=0;e<p.length;e++)(t=p[e]).size!==i?(c.size+=t.origSize,n=t.loaded*t.origSize/t.size,(!t.completeTimestamp||t.completeTimestamp>u)&&(r+=n),c.loaded+=n):c.size=i,t.status==l.DONE?c.uploaded++:t.status==l.FAILED?c.failed++:c.queued++;c.size===i?c.percent=p.length>0?Math.ceil(c.uploaded/p.length*100):0:(c.bytesPerSec=Math.ceil(r/((+new Date-u||1)/1e3)),c.percent=c.size>0?Math.ceil(c.loaded/c.size*100):0)}function R(){var e=h[0]||m[0];return!!e&&e.getRuntime().uid}function z(e,i){var n=this,r=0,s=[],o={runtime_order:e.runtimes,required_caps:e.required_features,preferred_caps:g,swf_url:e.flash_swf_url,xap_url:e.silverlight_xap_url};l.each(e.runtimes.split(/\s*,\s*/),function(t){e[t]&&(o[t]=e[t])}),e.browse_button&&l.each(e.browse_button,function(i){s.push(function(s){var u=new t.file.FileInput(l.extend({},o,{accept:e.filters.mime_types,name:e.file_data_name,multiple:e.multi_selection,container:e.container,browse_button:i}));u.onready=function(){var e=a.getInfo(this.ruid);l.extend(n.features,{chunks:e.can("slice_blob"),multipart:e.can("send_multipart"),multi_selection:e.can("select_multiple")}),r++,h.push(this),s()},u.onchange=function(){n.addFile(this.files)},u.bind("mouseenter mouseleave mousedown mouseup",function(t){_||(e.browse_button_hover&&("mouseenter"===t.type?l.addClass(i,e.browse_button_hover):"mouseleave"===t.type&&l.removeClass(i,e.browse_button_hover)),e.browse_button_active&&("mousedown"===t.type?l.addClass(i,e.browse_button_active):"mouseup"===t.type&&l.removeClass(i,e.browse_button_active)))}),u.bind("mousedown",function(){n.trigger("Browse")}),u.bind("error runtimeerror",function(){u=null,s()}),u.init()})}),e.drop_element&&l.each(e.drop_element,function(e){s.push(function(i){var s=new t.file.FileDrop(l.extend({},o,{drop_zone:e}));s.onready=function(){var e=a.getInfo(this.ruid);l.extend(n.features,{chunks:e.can("slice_blob"),multipart:e.can("send_multipart"),dragdrop:e.can("drag_and_drop")}),r++,m.push(this),i()},s.ondrop=function(){n.addFile(this.files)},s.bind("error runtimeerror",function(){s=null,i()}),s.init()})}),l.inSeries(s,function(){"function"==typeof i&&i(r)})}function O(e,i,n){var r=this,u=!1;function c(e,i,n){var a,o,c=s[e];switch(e){case"max_file_size":"max_file_size"===e&&(s.max_file_size=s.filters.max_file_size=i);break;case"chunk_size":(i=l.parseSize(i))&&(s[e]=i,s.send_file_name=!0);break;case"multipart":s[e]=i,i||(s.send_file_name=!0);break;case"http_method":s[e]="PUT"===i.toUpperCase()?"PUT":"POST";break;case"unique_names":s[e]=i,i&&(s.send_file_name=!0);break;case"filters":"array"===l.typeOf(i)&&(i={mime_types:i}),n?l.extend(s.filters,i):s.filters=i,i.mime_types&&("string"===l.typeOf(i.mime_types)&&(i.mime_types=t.core.utils.Mime.mimes2extList(i.mime_types)),i.mime_types.regexp=(a=i.mime_types,o=[],l.each(a,function(e){l.each(e.extensions.split(/,/),function(e){/^\s*\*\s*$/.test(e)?o.push("\\.*"):o.push("\\."+e.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),new RegExp("("+o.join("|")+")$","i")),s.filters.mime_types=i.mime_types);break;case"resize":s.resize=!!i&&l.extend({preserve_headers:!0,crop:!1},i);break;case"prevent_duplicates":s.prevent_duplicates=s.filters.prevent_duplicates=!!i;break;case"container":case"browse_button":case"drop_element":i="container"===e?l.get(i):l.getAll(i);case"runtimes":case"multi_selection":case"flash_swf_url":case"silverlight_xap_url":s[e]=i,n||(u=!0);break;default:s[e]=i}n||r.trigger("OptionChanged",e,i,c)}"object"==typeof e?l.each(e,function(e,t){c(t,e,n)}):c(e,i,n),n?(s.required_features=o(l.extend({},s)),g=o(l.extend({},s,{required_features:!0}))):u&&(r.trigger("Destroy"),z.call(r,s,function(e){e?(r.runtime=a.getInfo(R()).type,r.trigger("Init",{runtime:r.runtime}),r.trigger("PostInit")):r.trigger("Error",{code:l.INIT_ERROR,message:l.translate("Init error.")})}))}function S(e,t){if(e.settings.unique_names){var i=t.name.match(/\.([^.]+)$/),n="part";i&&(n=i[1]),t.target_name=t.id+"."+n}}function I(e,r){var s,a=e.settings.url,o=e.settings.chunk_size,u=e.settings.max_retries,c=e.features,f=0,p={runtime_order:e.settings.runtimes,required_caps:e.settings.required_features,preferred_caps:g,swf_url:e.settings.flash_swf_url,xap_url:e.settings.silverlight_xap_url};function h(){u-- >0?n(m,1e3):(r.loaded=f,e.trigger("Error",{code:l.HTTP_ERROR,message:l.translate("HTTP Error."),file:r,response:d.responseText,status:d.status,responseHeaders:d.getAllResponseHeaders()}))}function m(){var t,i,n={};r.status===l.UPLOADING&&e.state!==l.STOPPED&&(e.settings.send_file_name&&(n.name=r.target_name||r.name),e.settings.send_relative_path&&(n.relativePath=r.relativePath),e.settings.file_checksum&&(n.fileChecksum=r.checksum),o&&c.chunks&&s.size>o?(i=Math.min(o,s.size-f),t=s.slice(f,f+i)):(i=s.size,t=s),o&&c.chunks&&(e.settings.send_chunk_number?(n.chunk=Math.ceil(f/o),n.chunks=Math.ceil(s.size/o)):(n.offset=f,n.total=s.size)),e.trigger("BeforeChunkUpload",r,n,t,f)&&(e.settings.chunk_checksum?y(t,e.settings.chunk_size).then(function(e){n.chunkChecksum=e,_(n,t,i)}).catch(function(e){console.log(e),h()}):_(n,t,i)))}function _(i,o,g){var _;(d=new t.xhr.XMLHttpRequest).upload&&(d.upload.onprogress=function(t){r.loaded=Math.min(r.size,f+t.loaded),e.trigger("UploadProgress",r)}),d.onload=function(){d.status<200||d.status>=400?h():(u=e.settings.max_retries,g<s.size?(o.destroy(),f+=g,r.loaded=Math.min(f,s.size),e.trigger("ChunkUploaded",r,{offset:r.loaded,total:s.size,response:d.responseText,status:d.status,responseHeaders:d.getAllResponseHeaders()}),"Android Browser"===l.ua.browser&&e.trigger("UploadProgress",r)):r.loaded=r.size,o=_=null,!f||f>=s.size?(r.size!=r.origSize&&(s.destroy(),s=null),e.trigger("UploadProgress",r),r.status=l.DONE,r.completeTimestamp=+new Date,e.trigger("FileUploaded",r,{response:d.responseText,status:d.status,responseHeaders:d.getAllResponseHeaders()})):n(m,1))},d.onerror=function(){h()},d.onloadend=function(){this.destroy()},e.settings.multipart&&c.multipart?(d.open(e.settings.http_method,a,!0),l.each(e.settings.headers,function(e,t){d.setRequestHeader(t,e)}),_=new t.xhr.FormData,l.each(l.extend(i,e.settings.multipart_params),function(e,t){_.append(t,e)}),_.append(e.settings.file_data_name,o),d.send(_,p)):(a=l.buildUrl(e.settings.url,l.extend(i,e.settings.multipart_params)),d.open(e.settings.http_method,a,!0),l.each(e.settings.headers,function(e,t){d.setRequestHeader(t,e)}),d.hasRequestHeader("Content-Type")||d.setRequestHeader("Content-Type","application/octet-stream"),d.send(o,p))}function E(){l.isEmptyObj(e.settings.resize)||-1===l.inArray(s.type,["image/jpeg","image/png"])?m():function(e,n,r,s){var a=new t.image.Image;try{a.onload=function(){n.width>this.width&&n.height>this.height&&n.quality===i&&n.preserve_headers&&!n.crop?(this.destroy(),s(e)):a.downsize(n.width,n.height,n.crop,n.preserve_headers)},a.onresize=function(){var t=this.getAsBlob(e.type,n.quality);this.destroy(),s(t)},a.bind("error runtimeerror",function(){this.destroy(),s(e)}),a.load(e,r)}catch(t){s(e)}}(s,e.settings.resize,p,function(e){s=e,r.size=e.size,m()})}r.loaded&&(f=r.loaded=o?o*Math.floor(r.loaded/o):0),s=r.getSource(),e.settings.file_checksum&&void 0===r.checksum?y(s,e.settings.chunk_size).then(function(e){r.checksum=e,E()}).catch(function(e){console.log(e),h()}):E()}function w(e,t){v(t)}function T(e){if(e.state==l.STARTED)u=+new Date;else if(e.state==l.STOPPED)for(var t=e.files.length-1;t>=0;t--)e.files[t].status==l.UPLOADING&&(e.files[t].status=l.QUEUED,b())}function D(){d&&d.abort()}function x(e){b(),n(function(){E.call(e)},1)}function P(e,t){t.code===l.INIT_ERROR?e.destroy():t.code===l.HTTP_ERROR&&(t.file.status=l.FAILED,t.file.completeTimestamp=+new Date,v(t.file),e.state==l.STARTED&&(e.trigger("CancelUpload"),n(function(){E.call(e)},1)))}function F(e){e.stop(),l.each(p,function(e){e.destroy()}),p=[],h.length&&(l.each(h,function(e){e.destroy()}),h=[]),m.length&&(l.each(m,function(e){e.destroy()}),m=[]),g={},_=!1,u=d=null,c.reset()}s={chunk_size:0,file_data_name:"file",filters:{mime_types:[],max_file_size:0,prevent_duplicates:!1,prevent_empty:!0},flash_swf_url:"js/Moxie.swf",http_method:"POST",max_retries:0,multipart:!0,multi_selection:!0,resize:!1,runtimes:a.order,send_file_name:!0,send_relative_path:!0,send_chunk_number:!0,silverlight_xap_url:"js/Moxie.xap"},O.call(this,e,null,!0),c=new l.QueueProgress,l.extend(this,{id:f,uid:f,state:l.STOPPED,features:{},runtime:null,files:p,settings:s,total:c,init:function(){var e,t,i=this;return"function"==typeof(e=i.getOption("preinit"))?e(i):l.each(e,function(e,t){i.bind(t,e)}),function(){this.bind("FilesAdded FilesRemoved",function(e){e.trigger("QueueChanged"),e.refresh()}),this.bind("CancelUpload",D),this.bind("BeforeUpload",S),this.bind("UploadFile",I),this.bind("UploadProgress",w),this.bind("StateChanged",T),this.bind("QueueChanged",b),this.bind("Error",P),this.bind("FileUploaded",x),this.bind("Destroy",F)}.call(i),l.each(["container","browse_button","drop_element"],function(e){if(null===i.getOption(e))return t={code:l.INIT_ERROR,message:l.sprintf(l.translate("%s specified, but cannot be found."),e)},!1}),t?i.trigger("Error",t):s.browse_button||s.drop_element?void z.call(i,s,function(e){var t=i.getOption("init");"function"==typeof t?t(i):l.each(t,function(e,t){i.bind(t,e)}),e?(i.runtime=a.getInfo(R()).type,i.trigger("Init",{runtime:i.runtime}),i.trigger("PostInit")):i.trigger("Error",{code:l.INIT_ERROR,message:l.translate("Init error.")})}):i.trigger("Error",{code:l.INIT_ERROR,message:l.translate("You must specify either browse_button or drop_element.")})},setOption:function(e,t){O.call(this,e,t,!this.runtime)},getOption:function(e){return e?s[e]:s},refresh:function(){h.length&&l.each(h,function(e){e.trigger("Refresh")}),this.trigger("Refresh")},start:function(){this.state!=l.STARTED&&(this.state=l.STARTED,this.trigger("StateChanged"),E.call(this))},stop:function(){this.state!=l.STOPPED&&(this.state=l.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(){_=arguments[0]===i||arguments[0],h.length&&l.each(h,function(e){e.disable(_)}),this.trigger("DisableBrowse",_)},getFile:function(e){var t;for(t=p.length-1;t>=0;t--)if(p[t].id===e)return p[t]},addFile:function(e,i){var s,a=this,o=[],u=[];s=R(),function e(c){var d=l.typeOf(c);if(c instanceof t.file.File){if(!c.ruid&&!c.isDetached()){if(!s)return!1;c.ruid=s,c.connectRuntime(s)}e(new l.File(c))}else c instanceof t.file.Blob?(e(c.getSource()),c.destroy()):c instanceof l.File?(i&&(c.name=i),o.push(function(e){!function(e,t){var i=[];l.each(a.settings.filters,function(t,n){r[n]&&i.push(function(i){r[n].call(a,t,e,function(e){i(!e)})})}),l.inSeries(i,t)}(c,function(t){t||(p.push(c),u.push(c),a.trigger("FileFiltered",c)),n(e,1)})})):-1!==l.inArray(d,["file","blob"])?e(new t.file.File(null,c)):"node"===d&&"filelist"===l.typeOf(c.files)?l.each(c.files,e):"array"===d&&(i=null,l.each(c,e))}(e),o.length&&l.inSeries(o,function(){u.length&&a.trigger("FilesAdded",u)})},removeFile:function(e){for(var t="string"==typeof e?e:e.id,i=p.length-1;i>=0;i--)if(p[i].id===t)return this.splice(i,1)[0]},splice:function(e,t){var n=p.splice(e===i?0:e,t===i?p.length:t),r=!1;return this.state==l.STARTED&&(l.each(n,function(e){if(e.status===l.UPLOADING)return r=!0,!1}),r&&this.stop()),this.trigger("FilesRemoved",n),l.each(n,function(e){e.destroy()}),r&&this.start(),n},dispatchEvent:function(e){var t,i;if(e=e.toLowerCase(),t=this.hasEventListener(e)){t.sort(function(e,t){return t.priority-e.priority}),(i=[].slice.call(arguments)).shift(),i.unshift(this);for(var n=0;n<t.length;n++)if(!1===t[n].fn.apply(t[n].scope,i))return!1}return!0},bind:function(e,t,i,n){l.Uploader.prototype.bind.call(this,e,t,n,i)},destroy:function(){this.trigger("Destroy"),s=c=null,this.unbindAll()}})},l.Uploader.prototype=t.core.EventTarget.instance,l.File=function(){var e={};return function(t){l.extend(this,{id:l.guid(),name:t.name||t.fileName,type:t.type||"",relativePath:t.relativePath.replace(/^\.*\/+/,"")||t.name,size:t.fileSize||t.size,origSize:t.fileSize||t.size,loaded:0,percent:0,status:l.QUEUED,lastModifiedDate:t.lastModifiedDate||(new Date).toLocaleString(),completeTimestamp:0,getNative:function(){var e=this.getSource().getSource();return-1!==l.inArray(l.typeOf(e),["blob","file"])?e:null},getSource:function(){return e[this.id]?e[this.id]:null},destroy:function(){var t=this.getSource();t&&(t.destroy(),delete e[this.id])}}),e[this.id]=t}}(),l.QueueProgress=function(){var e=this;e.size=0,e.loaded=0,e.uploaded=0,e.failed=0,e.queued=0,e.percent=0,e.bytesPerSec=0,e.reset=function(){e.size=e.loaded=e.uploaded=e.failed=e.queued=e.percent=e.bytesPerSec=0}},e.plupload=l}(this,e)}.apply(e,arguments),e.plupload};"function"==typeof define&&define.amd?define("plupload",["./moxie"],i):"object"==typeof module&&module.exports?module.exports=i(require("./moxie")):e.plupload=i(e.moxie)}(this||window);